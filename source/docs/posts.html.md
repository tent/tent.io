---
title: Posts
layout: docs
---

Posts are the core of the Tent Protocol. Each piece of data in Tent, from
a status message to application configuration, is stored in a post.

Posts are JSON, and consist of three logical components: metadata, content, and
binary attachments.

## Entity

Every post has an `entity` (set by the server on creation). The `entity` is the
Entity URL that identifies the publisher of the post. If the entity changed URLs
since the post was published, there will be an additional `original_entity`
member that records the Entity URL that originally published the post before the
change.

## ID

The post `id` is generated by the server, and is a entity-local unique
identifier. The combination of `entity` and `id` is used to retrieve a post.

## Type

Each post has a `type`. The type is a URI that identifies the schema and
semantics associated with a post. Types are HTTPS URIs and must have
a fragment. Currently the URI is not used as a URL, but in the future it will be
the location of the machine-readable post schema, so it must point at an
internet-routable address that the creator has control over. The fragment is
used to provide additional information and/or semantics, but does not indicate
a different data schema. To create a new type, just start using it.

**Examples**

```text
https://tent.io/types/status/v0#reply
https://tent.io/types/delete/v0#
```

## Content

The `content` member of the POST JSON is where "data" lives. It contains an
arbitrary JSON object that may contain all valid JSON types with the exception
of floating point numbers. This object is expected to follow a consistent schema
that is the same across all posts of the same type.

## Versions

Each post has one or more versions. Versions are identified by the `version.id`
member. The version ID is the hex-encoded first 256 bits of a SHA-512 of the
[canonical post JSON](#canonical-post-json) calculated by the server. Post
versions list zero or more "parent versions". Each version created after the
first version of a post must reference at least one previous version of the same
post. These `parents` form a [directed acyclic
graph](https://en.wikipedia.org/wiki/Directed_acyclic_graph) of the history of
a post and may also refer to other posts including posts published by other
entities.

The version may also optionally have a `version.message`, this may be used as the
version "commit message".


## Timestamps

Posts have four timestamps associated with them. Timestamps are stored as the
number of milliseconds since the [Unix
epoch](https://en.wikipedia.org/wiki/Unix_time) (not counting leap seconds), and
do not have timezone information. The first, `published_at` may be set by the
application when the first version of a post is created. It does not change in
subsequent versions.

The second timestamp, `received_at` is set when a server receives the post.
`received_at` is only exposed to applications, not other entities, and is set by
the server receiving the post, not the publisher.

Each version also has `version.received_at` and `version.published_at` with the
same semantics, but change for each version instead of each post.

## Permissions

Each post version has a set of permissions associated with it. These permissions
specify entities and groups of entities that can see the post. If the
`permissions.public` flag is set to `true`, everyone can see the post. If
`false`, only the entities listed in the `permissions.entities` and members of
the groups listed in `permissions.groups` can see the post.

Permissions vary on a per-version basis, and the most recent version that the
requester is permitted to see is shown.

## Mentions

Mentions link to a specific entity, post, or version. A cross between the CC
field of an email and a hyperlink, mentions allow posts to be linked and
referenced. When a post is published that mentions an entity and she is
permitted access, a notification is sent to her automatically. The posts feed
allows rich querying based on mentions, and the list of posts that mention
a given post can be retrieved easily.

Mentions have a `mentions.public` flag that may optionally be set to `false`,
hiding the mention from all but the target entity. Unlike public mentions,
private mentions may be added to existing post versions.

## Refs

Refs reference another post or version. Typically used to embed content in
a post, they allow apps to fetch posts and referenced posts in the same request.

## Attachments

Attachments are files that are attached to posts. When a post is created,
a multipart request that includes files can be made. These files are attached to
the post and listed in the `attachments` array. They may also be copied from
existing posts and versions by copying the object from the `attachments` array
into the new post. Attachments are not copied to new versions by default.

A digest of each uploaded attachment is calculated and used as the unique
identifier. This digest is the hex-encoded first 256 bits of a SHA-512 of the
attachment data, and may also be used to verify that the attachment was not
corrupted during download or upload.

Multiple attachments with the same `name` may be uploaded, as long as their
`content_type` differs. This allows for type negotiation via the `Accept`
request header using the `post_attachment` endpoint.

## Post Schema

{post schema}

## Canonical Post JSON

The canonical post JSON format provides meaningful and repeatable hashes of
JSON-encoded posts.

The grammar for canonical JSON is a subset of the grammar at
[json.org](http://json.org/):

```text
object:
    {}
    { members }
 members:
   pair
   pair , members
pair:
   string : value
array:
   []
   [ elements ]
elements:
   value
   value , elements
value:
   string
   number
   object
   array
   true
   false
   null
string:
   ""
   " chars "
chars:
   char
   char chars
char:
   any byte except hex 22 (") or hex 5C (\)
   \\
   \"
number:
   int
int:
   digit
   digit1-9 digits
   - digit1-9
   - digit1-9 digits
digits:
   digit
   digit digits
```

- Floating point numbers are not allowed.
- Leading zeros and "minus zero" are not allowed.
- All object keys must be quoted, and must appear in sorted order.
- All whitespace is eliminated.
- Trailing commas in members and elements are not allowed.
- Only one 'escape' sequence is defined for strings, and it is only used for
  quote and backslash.
- The `permissions`, `app.id`, `received_at`, `version.received_at` and `version.id`
  members are removed.
- Elements of the `mentions` array with the `public` member set to `false` are
  removed.
- All `original_entity` members (in the post object as well as `mentions`,
  `refs`, and `version.parents` array elements) are removed and their sibling
  `entity` members values are replaced with the `original_entity` value.
- Empty members are removed. The members that may be empty are `app`,
  `attachments`, `mentions`, `refs`, `content`, `licenses`, `version.parents`,
  `version.message`, and `version`.
- Optional members that contain redundant data are removed. Currently this is
  defined as the `post` and `entity` members of a `version.parents`, `mentions`,
  and `refs` array element when they refer to the identifier or entity of the
  post that contains them.

*Based on a spec from the [OLPC wiki](http://wiki.laptop.org/go/Canonical_JSON).*
